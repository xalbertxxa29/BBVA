<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Mis Tareas</title>
  <link rel="icon" href="favicon.ico" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Scrim + Drawer -->
  <div id="scrim" class="scrim" aria-hidden="true"></div>
  <aside id="side-menu" class="side-menu" aria-hidden="true">
    <div class="user-details">
      <p id="user-email">Usuario</p>
    </div>
    <ul>
      <li><a href="menu.html">Mis Tareas</a></li>
      <li><a href="#">Tareas Rechazadas</a></li>
      <li><a href="#">Mapa de Tareas</a></li>
      <li><a href="#">Historial</a></li>
      <li><a href="#">Dashboard</a></li>
      <li><a href="#">Cambiar de Equipo</a></li>
      <li><a href="#">Ajustes</a></li>
    </ul>
    <button id="logout" class="btn btn-danger logout-btn">Cerrar Sesión</button>
  </aside>

  <!-- Header -->
  <header class="header">
    <div class="title">
      <button id="menu-btn" class="menu-btn" aria-label="Menú">☰</button>
      <h1 style="margin:0">Mis Tareas</h1>
    </div>
    <p id="today"></p>
  </header>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="pend">Pendientes</button>
    <button class="tab-btn" data-tab="ini">Iniciados</button>
    <button class="tab-btn" data-tab="comp">Completados</button>
  </div>

  <!-- Contenidos -->
  <section id="tab-pend" class="tab-content active">
    <h2>Pendientes</h2>
    <p>Tu ubicación actual en el mapa:</p>
    <div id="map" style="width:100%;height:330px;border:1px solid var(--border);border-radius:12px;"></div>
  </section>

  <section id="tab-ini" class="tab-content"><p>Sin datos por ahora.</p></section>
  <section id="tab-comp" class="tab-content"><p>Sin datos por ahora.</p></section>

  <!-- FAB: ⋮ que despliega el + -->
  <div class="fab-container" id="fab">
    <button id="fab-more" class="fab" aria-expanded="false" title="Más">⋮</button>
    <div class="fab-options" id="fab-options">
      <button id="fab-plus" class="fab" title="Nueva tarea">+</button>
    </div>
  </div>

  <!-- Modal NUEVA TAREA (FIX: glass-loader para centrado correcto) -->
  <div id="new-overlay" class="overlay" aria-hidden="true">
    <div class="glass-loader" role="dialog" aria-modal="true" aria-labelledby="new-title">
      <div class="glass-card">
        <h3 id="new-title" class="loader-title">Nueva tarea</h3>
        <p class="loader-sub" style="margin-top:-6px">Selecciona el tipo de formulario</p>

        <div style="margin:10px 0 16px;">
          <select id="new-type" class="input">
            <option value="">Seleccionar…</option>
            <option value="ofi">OFICINAS</option>
            <option value="caj">CAJEROS</option>
          </select>
        </div>

        <div style="display:flex; gap:10px; justify-content:flex-end;">
          <button id="new-cancel" class="btn btn-ghost">Cancelar</button>
          <button id="new-continue" class="btn btn-danger">Continuar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Overlay de carga global (opcional) -->
  <div id="overlay" class="overlay" aria-hidden="true">
    <div class="glass-loader">
      <div class="glass-card">
        <div class="loader-ring">
          <span class="ring r1"></span><span class="ring r2"></span>
          <span class="logo"><img src="icon-192.png" alt="LiderControl"></span>
        </div>
        <div class="loader-title" id="overlay-msg">Cargando…</div>
        <div class="progress-bar"><div class="progress-fill" id="overlay-progress"></div></div>
        <p class="loader-sub" id="overlay-sub">Conectando con servicios</p>
      </div>
    </div>
  </div>

  <!-- Firebase compat + config -->
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.9.0/firebase-storage-compat.js"></script>
  <script src="firebase-config.js"></script>

  <!-- Lógica principal -->
  <script src="menu.js"></script>

  <!-- Google Maps -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDlOoCAxAvWK5kpBkmnefd5dC62ns8v1pU&callback=initMap"></script>

  <!-- Pequeño refuerzo inline: redirección del modal (por si no cargas menu.js) -->
  <script>
    (function () {
      const ov = document.getElementById('new-overlay');
      const typeSel = document.getElementById('new-type');
      const btnOk = document.getElementById('new-continue');
      const btnCancel = document.getElementById('new-cancel');
      const plus = document.getElementById('fab-plus');

      function openModal(){ ov.classList.add('active'); ov.setAttribute('aria-hidden','false'); setTimeout(()=>typeSel.focus(),50); }
      function closeModal(){ ov.classList.remove('active'); ov.setAttribute('aria-hidden','true'); }

      plus?.addEventListener('click', (e)=>{ e.preventDefault(); openModal(); });
      btnCancel?.addEventListener('click', closeModal);
      ov?.addEventListener('click', (ev)=>{ if (ev.target===ov) closeModal(); });
      document.addEventListener('keydown', (ev)=>{ if (ov.classList.contains('active') && ev.key==='Escape') closeModal(); });

      btnOk?.addEventListener('click', ()=>{
        const v = typeSel.value;
        if(!v){ alert('Elige una opción.'); return; }
        closeModal();
        if (v==='ofi') location.href = 'formularioof.html';
        if (v==='caj') location.href = 'formulariocaj.html';
      });
    })();
  </script>
</body>
</html>
